<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> Explaining Graph Neural Network (GNN)-based Malware Classification | </title> <meta name="description" content=" post 16 "> <meta name="keywords" content="gnn, graph, neural, network, classification, malware, control flow graph, cfg, deep learning, explainable AI, AI, machine learning, cybersecurity"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="Jerome Dinal Herath"> <meta property="article:section" content=""> <meta property="article:tag" content="gnn, graph, neural, network, classification, malware, control flow graph, cfg, deep learning, explainable AI, AI, machine learning, cybersecurity"> <meta property="article:published_time" content="2022-12-23 00:00:00 -0800"> <meta property="og:url" content="http://dinalherath.com/2022/cfgexplainer/"> <meta property="og:title" content=" Explaining Graph Neural Network (GNN)-based Malware Classification | "> <meta property="og:image" content="http://dinalherath.com"> <meta property="og:description" content=" post 16 "> <meta property="og:site_name" content="Jerome Dinal Herath"> <meta property="og:locale" content="en_US"> <!-- Social: Twitter --> <meta name="twitter:card" content=""> <meta name="twitter:site" content=""> <meta name="twitter:title" content=" Explaining Graph Neural Network (GNN)-based Malware Classification | "> <meta name="twitter:description" content=" post 16 "> <meta name="twitter:image:src" content="http://dinalherath.com"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" Explaining Graph Neural Network (GNN)-based Malware Classification | "> <meta itemprop="description" content=" post 16 "> <meta itemprop="image" content="http://dinalherath.com"> <!-- rel prev and next --> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="stylesheet" href="/assets/css/font-awesome.min.css"> <!-- Canonical link tag --> <link rel="canonical" href="http://dinalherath.com/2022/cfgexplainer/"> <link rel="alternate" type="application/rss+xml" title="" href="http://dinalherath.com/feed.xml"> <script type="text/javascript"> var disqus_shortname = ''; var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-99988883-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="/"><span></span></a></h1> <ul class="navbar"> <li><a href="/">Home</a></li> <li><a href="/blog">Blog</a></li> <li><a href="/about me">About</a></li> <!-- <li><a href="/Resume.pdf">Resume</a></li> --> <!-- <li><a href="/resume">Resume</a></li>--> <!--<li><a href="/contact">Contact</a></li>--> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"> </script> <p class="post-meta"><time datetime="2022-12-23T00:00:00-08:00" itemprop="datePublished">Dec 23, 2022</time></p> <h1 class="post-title" itemprop="name headline">Explaining Graph Neural Network (GNN)-based Malware Classification</h1> </header> <div class="post-content" itemprop="articleBody"> <p>Hi All!! today I will be writing about another piece of research I completed as part of my PhD. The premise of this work revolves around <a href="https://en.wikipedia.org/wiki/Explainable_artificial_intelligence">explainable-AI</a>, specifically in the domain of cybersecurity. In recent years there has been an increasing effort of utilizing Machine Learning and Deep Learning models for cybersecurity applications, ranging from intrusion detection to malware classification.</p> <p>However, most of these state-of-the-art deep learning models are treated as black-boxes, meaning that we arenâ€™t able to explain why a given model predicts some malicious activity, which makes it hard for an analyst or threat hunter to identify if an alert is truly malicious. To circumvent this issue there has been a growing interest in explaining deep learning models used for cybersecurity tasks.</p> <p><img src="/material/2022/post_16/expl.jpeg?raw=true" alt="graph-explanations" width="800px" /></p> <p>In my PhD work we pushed the boundary in explaining deep-learning based malware classification by introducing an explainer named <code class="language-plaintext highlighter-rouge">CFGExplainer</code> (<a href="https://www.dinalherath.com/papers/2022dsn.pdf">paper</a>, <a href="https://github.com/dherath/CFGExplainer">code</a>). <a href="https://blogs.nvidia.com/blog/2022/10/24/what-are-graph-neural-networks/">Graph Neural Networks</a> have shown great promise in malware classification tasks, where the malware source code is processed and presented in a graph format called an <code class="language-plaintext highlighter-rouge">Attributed Control Flow Graph (ACFG)</code>. However, explaining how these detections work is hard, mainly because a given malware graph can have over thousands of nodes and edges. Identifying which exact portion of the graph (i.e., subgraph) represents malicious code while pruning out the less important bits efficiently is the main challenge addressed in this work.</p> <h3 id="malware-classification-with-gnns">Malware classification with GNNs</h3> <p><img src="/material/2022/post_16/acfg.jpeg?raw=true" alt="acfg" width="640px" /></p> <p>In this first section, I will go through a brief overview of how source code is converted to a graph format for our detection task. Typically, in an <code class="language-plaintext highlighter-rouge">Attributed Control Flow Graph</code> nodes represent basic blocks of code that have atomic executions as shown in the image above. The edges between these basic blocks are the connectivity through <code class="language-plaintext highlighter-rouge">call</code>, <code class="language-plaintext highlighter-rouge">jump</code> instructions or of how the code flows through from one block to another. For each node, we define node features based on the type of instructions present within the code block.</p> <p><img src="/material/2022/post_16/gnn.jpeg?raw=true" alt="acfg" width="600px" /></p> <p>After this step, the graphs are processed by a Graph Neural Network (GNN) model. A GNN model usually operates in two stages. First it processes the node/edge features and the spatial connectivity in the graph to produce <code class="language-plaintext highlighter-rouge">node embeddings</code>. These node embeddings are latent representations of nodes that capture information useful for some subsequent task, in our case the node embeddings contain important information with respect to malware classification. Then in the next stage the node embeddings are processed by a feed forwarding neural network that produces classification probabilities based on the malware types.</p> <h3 id="cfgexplainer">CFGExplainer</h3> <p><img src="/material/2022/post_16/cfgexpl.jpeg?raw=true" alt="cfgexplainer" width="780px" /></p> <p>The figure above shows the architecture of our solution. In our work, we assume that there exists some GNN model that is capable of classifying attributed control flow graphs into their respective malware types. Initially the graph samples to be explained are processed by the GNN classifier, which produces both the node embeddings and the malware class labels. Then these embeddings, labels and the original graphs are provided to CFGExplainer.</p> <p>CFGExplainer operates in two stages. First in an <strong>initial learning stage</strong>, the explainer learns to score nodes with respect to their contribution towards malware classification. Then in the second stage the explainer prunes out nodes that have the least importance. This pruned subgraph is provided as an explanation to the analyst along with an ordering of nodes based on importance to classification.</p> <p>The learning stage is carried out through two interconnected neural network components (a node scoring module and a surrogate classifier) that are jointly trained to identify important nodes.</p> <p><img src="/material/2022/post_16/learning.jpeg?raw=true" alt="forward-pass" width="620px" /></p> <p>In the forward pass in this algorithm,</p> <ol> <li>First the node embeddings are processed and a score is produced for each embedding. Here a larger score correspond to the node being viewed as more important.</li> <li>Then the scores are multiplied against the original node embeddings to produce a weighted node embedding per node.</li> <li>Finally, these weighted node embeddings are fed through a second neural network module (i.e., a surrogate classifier) that produces classification probabilities for the malware families.</li> </ol> <p>After producing the classification probabilities, the backward pass is carried out as a back-propagation step where the objective is to mimic the malware detection capability of the original GNN model through this surrogate classifier using weighted node embeddings. Notice that due to this joint training, as the surrogate classifier learns to better mimic the original GNN, the node scoring module learns to produce higher scores for more important nodes.</p> <p><img src="/material/2022/post_16/training.jpeg?raw=true" alt="backward-pass" width="620px" /></p> <p>Once this training is completed using all the graphs to be explained, the explainer can directly prune out nodes with smaller scores, leaving a subgraph that contributes most towards the malware classification task.</p> <p>In our experiments we found that CFGExplainer is able to produce subgraphs (~20% original size) that indicate malicious patterns such as obfuscation tricks and code manipulations that would have been harder to manually identify by analyzing the complete malware graph. If you want to learn more about <strong>CFGExplainer</strong> please check our <a href="https://www.dinalherath.com/papers/2022dsn.pdf">paper</a> and <a href="https://github.com/dherath/CFGExplainer">code</a>.</p> <p><img src="/material/2022/post_16/results.jpeg?raw=true" alt="results" width="820px" /></p> <h5 id="so-until-next-time">So until next time,</h5> <h5 id="cheers">Cheers!</h5> <p><strong>Prev: <a href="/2021/lam/">Fooling AI-based System Log Anomaly Detection</a></strong></p> <aside class="share"> <p>If you liked this article and think others should read it, please <a href="http://twitter.com/share?text=Explaining Graph Neural Network (GNN)-based Malware Classification&amp;url=http://dinalherath.com/2022/cfgexplainer/&amp;via=" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">share it on Twitter <i class="fa fa-twitter" aria-hidden="true" style="color:#00aced"></i></a> or <a href='https://www.facebook.com/sharer/sharer.php?u='+url; onclick="window.open(this.href, 'sharer', 'toolbar=0,status=0,width=550,height=235');return false;">Facebook <i class="fa fa-facebook-square" aria-hidden="true" style="color:#3b5998"></i></a>.</p> </aside> </div> </article> <!-- --> <footer class="site-footer"> <!--<link rel="stylesheet" href="/assets/icons/academicons-1.8.0/css/academicons.css"/>--> <div class="container"> <small class="block"><!--&lt;/&gt; <a href="http://github.com/heiswayi/thinkspace" title="a minimalist Jekyll theme for technical writing">Thinkspace theme</a> by <a href="http://heiswayi.github.io">Heiswayi Nrird</a>. |--><i class="fa fa-copyright"></i> 2017-2023 Jerome Dinal Herath</small> <!-- <a href="mailto:dinal.bing@gmail.com"><i class="fa fa-envelope" style="font-size:21px;color:#F15B3D;"></i></a> --> <!-- <a href="https://www.facebook.com/dinalHerath" target="_blank"><i class="fa fa-facebook-square" style="font-size:22px;color:#F15B3D"></i></a> --> <a href="https://github.com/dherath" target="blank"><i class="fa fa-github-square" style="font-size:22px;color:#F15B3D"></i></a> <a href="https://www.linkedin.com/in/jerome-dinal-herath-bba3b0148/" target="blank"><i class="fa fa-linkedin-square" style="font-size:22px;color:#F15B3D"></i></a> <a href="https://scholar.google.com/citations?user=vNtiUMwAAAAJ&hl=en" target="blank"><i class="fa fa-google" style="font-size:22px;color:#F15B3D"></i></a> <!-- <a href="/feed.xml" target="_blank"><i class="fa fa-rss-square" style="font-size:22px;color:#F15B3D"></i></a> --> <!--<a href="https://www.researchgate.net/profile/Jerome_Dinal_Herath" target="blank"> <i style="font-size:20px;color:#F15B3D;font-weight:bold;"> RG </i></a> --> </div> </footer> </main> </body> </html>
