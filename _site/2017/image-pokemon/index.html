<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> Combining video-game sprites using logical operations | </title> <meta name="description" content=" post 3 "> <meta name="keywords" content="image processing, logic, operations, AND, NOT, OR, example"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="Jerome Dinal Herath"> <meta property="article:section" content=""> <meta property="article:tag" content="image processing, logic, operations, AND, NOT, OR, example"> <meta property="article:published_time" content="2017-07-23 00:00:00 -0400"> <meta property="og:url" content="http://localhost:4000/2017/image-pokemon/"> <meta property="og:title" content=" Combining video-game sprites using logical operations | "> <meta property="og:image" content="http://localhost:4000"> <meta property="og:description" content=" post 3 "> <meta property="og:site_name" content="Jerome Dinal Herath"> <meta property="og:locale" content="en_US"> <!-- Social: Twitter --> <meta name="twitter:card" content=""> <meta name="twitter:site" content=""> <meta name="twitter:title" content=" Combining video-game sprites using logical operations | "> <meta name="twitter:description" content=" post 3 "> <meta name="twitter:image:src" content="http://localhost:4000"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" Combining video-game sprites using logical operations | "> <meta itemprop="description" content=" post 3 "> <meta itemprop="image" content="http://localhost:4000"> <!-- rel prev and next --> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="stylesheet" href="/assets/css/font-awesome.min.css"> <!-- Canonical link tag --> <link rel="canonical" href="http://localhost:4000/2017/image-pokemon/"> <link rel="alternate" type="application/rss+xml" title="" href="http://localhost:4000/feed.xml"> <script type="text/javascript"> var disqus_shortname = ''; var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-99988883-1']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"><a href="/"><span></span></a></h1> <ul class="navbar"> <li><a href="/">About</a></li> <li><a href="/blog">Blog</a></li> <li><a href="/research">Research</a></li> <li><a href="/dinal_cv.pdf">CV</a></li> <!-- <li><a href="/resume">Resume</a></li>--> <!--<li><a href="/contact">Contact</a></li>--> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"> </script> <p class="post-meta"><time datetime="2017-07-23T00:00:00-04:00" itemprop="datePublished">Jul 23, 2017</time></p> <h1 class="post-title" itemprop="name headline">Combining video-game sprites using logical operations</h1> </header> <div class="post-content" itemprop="articleBody"> <p><img src="https://raw.githubusercontent.com/dherath/WebsiteMaterial/master/2017/post_3_boolean_algebra_pokemon/images/front_matter.png" alt="front-image" /></p> <p>Today I’m going to explain how different video-game sprites(<em>or any image</em>) can be combined together like whats shown above using logical operations like <strong>AND, OR, NOT</strong> in the realm of <code class="highlighter-rouge">Image Processing</code>. This is an extremely interesting area I got to sample during my undergrad days, and I thought of making my second post from a memorable part of it. For the demonstrations I thought of using sprites from one of my all time favorite pokemon games, <a href="https://bulbapedia.bulbagarden.net/wiki/Pok%C3%A9mon_Gold_and_Silver_Versions" target="blank">pokemon silver</a> from Generation 2 which I played first :).</p> <h3 id="some-basicsskip-if-youre-not-new-to-image-processing">Some Basics(<a href="#ref1">Skip</a> if you’re not new to Image Processing)</h3> <p>First of all a brief introduction to images. I’m sure you all know something about different types of screen resolutions like HD, 488p and so on. The difference between these types of resolutions are the number of <strong>pixels</strong> in a given view. Think of an image as a 2D grid of small squares where each square represents a dot of color, and higher the resolution the larger the number of squares in a picture. These squares are called <strong><em>pixels</em></strong>. In a digital image a pixel stores some kind of numeric value, where each numeric value represents some color. <code class="highlighter-rouge">For example in grayscale images the value 0 represents black and 255 white and all integers between are shades of gray.</code></p> <p>We all know that the three primary colors are <strong>red, blue and green</strong>. Likewise color images (RGB) could be represented as a combination of three channels or sub-images for red, blue and green as shown below. Each of these sub-images are represented in <a href="https://en.wikipedia.org/wiki/Grayscale" target="blank">grayscale</a>. In fact these sub-images don’t really have a color per-say, rather some intensity vale[0-255] which is shown in shades of gray.</p> <p><img src="https://raw.githubusercontent.com/dherath/WebsiteMaterial/master/2017/post_3_boolean_algebra_pokemon/images/rgb_seperated.png" alt="rgb_seperated" /></p> <p>Now if you look closely at the character image it’s mostly red, therefore the red-channel has values closer to 255 which is why that channel looks brighter as opposed to the blue-channel which is very dark. Similarly for the background, the green-channel is the brightest image because the original background shows a forest.</p> <h4 id="logical-operations-in-image-processing">Logical operations in Image Processing</h4> <p>The basic logical operations in image processing are the same as in arithmetic <strong><code class="highlighter-rouge">AND, NOT and OR</code></strong>.</p> <p><img src="https://upload.wikimedia.org/wikipedia/commons/4/4a/Truth_table_for_AND%2C_OR%2C_and_NOT.png" alt="truth-table" width="400px" /></p> <p>For logical operations to work on images, the images need to be of a specific type called <code class="highlighter-rouge">binary</code>. As the name suggests the pixels of these images could only have two values <strong>1(for white) or 0(for black)</strong>. So basically these are the main operations I’ll be using to combine the pokemon game sprites. The images below illustrate the outcome of logical operations on binary images.</p> <h4 id="1-not-operation">1) NOT operation</h4> <p><img src="https://raw.githubusercontent.com/dherath/WebsiteMaterial/master/2017/post_3_boolean_algebra_pokemon/theory_examples/not_image.png" alt="not-image-example" height="200px" /></p> <p>The <strong>NOT</strong> operation inverts a given input value(0 to 1 &amp; vice-versa), its the same principle for images where instead of one single point or location entire regions get inverted depending on their pixel values; so a black area become white or a white area becomes black respectively.</p> <h4 id="2-or-operation">2) OR operation</h4> <p><img src="https://raw.githubusercontent.com/dherath/WebsiteMaterial/master/2017/post_3_boolean_algebra_pokemon/theory_examples/or.png" alt="or-image-example" height="200px" /></p> <p>The <strong>OR</strong> operation combines two binary images such that value 1s of both images show up in the final output. Thats the reason the combination of both the white circles are present in the above output image.</p> <h4 id="3-and-operation">3) AND operation</h4> <p><img src="https://raw.githubusercontent.com/dherath/WebsiteMaterial/master/2017/post_3_boolean_algebra_pokemon/theory_examples/and.png" alt="and-image-example" height="180px" /></p> <p>The <strong>AND</strong> operation functions in a similar fashion as described in the table above. In this example unlike in the <strong>OR</strong> case, only the intersection of the two circles are shown in the output. Here the output only shows a high value(1) when both images represent a high value for the same (x,y) coordinate respectively.</p> <h3 id="combining-game-sprites"><a name="ref1">Combining game sprites</a></h3> <p>From here on, I’ll be explaining the main steps in combining image sprites. I’ve used the software platform <strong><code class="highlighter-rouge">Matlab</code></strong> for this demonstration. Also note that in the code examples I’ve used a function, the reason being the steps I explain below need to be operated three times iteratively for all red, blue and green channels of a given image. Instead of repeating the same code, I figured using functions would make my life more easier. <code class="highlighter-rouge">If you have no idea about the Matlab image processing toolbox click</code> <strong><a href="https://in.mathworks.com/help/images/getting-started-with-image-processing-toolbox.html" target="blank">here</a></strong> <code class="highlighter-rouge">and if you need a refresher on Matlab functions click </code><strong><a href="https://in.mathworks.com/help/matlab/matlab_prog/create-functions-in-files.html" taget="blank">here</a> :)</strong>. <strong><em><a href="#ref2">(Click here to go directly to the CODE)</a></em></strong></p> <h5 id="step-1--converting-rgbcolor-images-to-binary-images">Step 1 : Converting RGB(Color) images to Binary images</h5> <p>The first step is to convert our input images to a binary format so that we can use logical operations. Initially we separate the three channels of red, green and blue and afterwards convert them to purely black and white. In <strong><code class="highlighter-rouge">matlab</code></strong> we can do this using a function called <code class="highlighter-rouge">im2bw()</code>. The images below show the output for this step.</p> <p><img src="https://raw.githubusercontent.com/dherath/WebsiteMaterial/master/2017/post_3_boolean_algebra_pokemon/step1.png" alt="binary-images" /></p> <h5 id="step-2--create-an-inverted-mask-of-the-binary-background-image">Step 2 : Create an inverted mask of the binary background image</h5> <p>The second step is to create a temporary image or mask which is an inverted output of the binary background image.</p> <p><img src="https://raw.githubusercontent.com/dherath/WebsiteMaterial/bc226401273ab062b18245a6b9adcf4ab002de4f/2017/post_3_boolean_algebra_pokemon/step2.png" alt="inverted-binary-background" height="200px" /></p> <h5 id="step-3--create-temporary-mask-1">Step 3 : Create temporary Mask 1</h5> <p>In this step a temporary mask is created using the two output images from steps 1 &amp; 2. The <strong>AND</strong> operations is used on the <code class="highlighter-rouge">inverted-background image and the binary-character</code> image in order to get a mask with a certain property. If you look closely at the output image, all the pixels describing the character are black <em>(value 0)</em> where as the rest of the background is the same. Which means any operation done on this mask would only affect the background and the character portion of the image will remain unchanged.</p> <p><img src="https://raw.githubusercontent.com/dherath/WebsiteMaterial/bc226401273ab062b18245a6b9adcf4ab002de4f/2017/post_3_boolean_algebra_pokemon/step3.png" alt="Mask-1" /></p> <h5 id="step-4--create-temporary-mask-2">Step 4 : Create temporary Mask 2</h5> <p>To get the second temporary mask, the <strong>NOT</strong> operation is used on the Mask image obtained in the previous step. Here the output image is such that all the background pixels remain in its binary state where as the character portion becomes value 1 or <em>white</em>. Therefore any operation done to the image will only affect the character and the background will be unaffected.</p> <p><img src="https://raw.githubusercontent.com/dherath/WebsiteMaterial/bc226401273ab062b18245a6b9adcf4ab002de4f/2017/post_3_boolean_algebra_pokemon/step4.png" alt="Mask-2" height="200px" /></p> <h5 id="step-5--process-masks-with-original-images">Step 5 : Process Masks with original images</h5> <p>By now we have two separate masks which give the opportunity to manipulate color intensities of the character and the background separately. However these masks are binary, meaning the values are either 1 or 0. The pixel intensities for original images for each channel(red, green or blue) vary between 0 and 255. In order to get this range into the obtained masks, each mask is <code class="highlighter-rouge">point-wise multiplied</code> by the respective input images.</p> <p><strong><em>So what’s this point-wise multiplication?</em></strong> Earlier I explained that images are like a 2D-grid, and they are stored in matlab as a 2-D matrix. Usually in matrix multiplication, a row is multiplied by a column of another matrix and all the individual values are summed together to obtain a value of one cell in a new matrix. <strong><code class="highlighter-rouge">However, in point-wise multiplication each cell indexed some (x,y) of matrix A is multiplied by another cell of index (x,y) of some matrix B to obtain the answer.</code></strong> Here there is no summation or rowise/columnwise multiplication.</p> <p><img src="https://raw.githubusercontent.com/dherath/WebsiteMaterial/bc226401273ab062b18245a6b9adcf4ab002de4f/2017/post_3_boolean_algebra_pokemon/step5.png" alt="processed-images" /></p> <p>If you look closely at the output images. The character image has the original character in the image in addition to a binary representation of the background. In the background output image, the background pixels have the same intensity values as per the input image where as the character section is binary. Basically, the only step left to take is combine these two separate output images into one single image.</p> <h5 id="step-6--combine-the-character-image-and-background-image">Step 6 : Combine the character image and background image</h5> <p>This step is all about combining the separate outputs into one. There are a couple of ways to go about this step, in my case I opted to go by selecting the maximum pixel intensity for each (x,y) coordinate of both the output images and creating a new image with this maximum value. My rational for this method was that the intensity distribution for every pixel would be definitely between 0 and 255, thus by selecting the maximum at each point I’d minimize the probability of selecting a stray 0 (black) pixel.</p> <p><img src="https://raw.githubusercontent.com/dherath/WebsiteMaterial/bc226401273ab062b18245a6b9adcf4ab002de4f/2017/post_3_boolean_algebra_pokemon/step6.png" alt="combined-image" /></p> <p>And there you go!!! :) This is the combined image for the red channel from separate sprites for a game character and a specific background.</p> <h5 id="step-7--combine-separate-channels-rgb-into-a-colorrgb-image">Step 7 : Combine separate channels (R,G,B) into a color(RGB) image</h5> <p>The final step is all about iterating the above steps from 1-6 for each color channel and combining them together in order to create a color image. This step is crucial for a color image, because the output from step 6 only shows a distribution of intensity values for a given image, The only reason we see the differences in shades of gray is because we map those intensity values to some color scale. Therefore, to combine the separate channels a new image is created of type unit8 and the outputs from step 6 combined into it.</p> <p><img src="https://raw.githubusercontent.com/dherath/WebsiteMaterial/bc226401273ab062b18245a6b9adcf4ab002de4f/2017/post_3_boolean_algebra_pokemon/step7.png" alt="final" /></p> <h3 id="code"><a name="ref2">Code</a></h3> <h5 id="the-main-program">The main program</h5> <div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">clc</span><span class="p">;</span>
<span class="nb">clear</span><span class="p">;</span>
<span class="n">man</span> <span class="o">=</span> <span class="nb">imread</span><span class="p">(</span><span class="s1">'silver.png'</span><span class="p">);</span> <span class="c1">% loading images</span>
<span class="n">back</span> <span class="o">=</span> <span class="nb">imread</span><span class="p">(</span><span class="s1">'background.png'</span><span class="p">);</span>

<span class="n">man_r</span><span class="o">=</span><span class="n">man</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">);</span> <span class="c1">% separate input character image to r,g,b channels</span>
<span class="n">man_g</span><span class="o">=</span><span class="n">man</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">man_b</span><span class="o">=</span><span class="n">man</span><span class="p">(:,:,</span><span class="mi">3</span><span class="p">);</span>

<span class="n">back_r</span> <span class="o">=</span> <span class="n">back</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">);</span><span class="c1">% separate input background image to r,g,b channels</span>
<span class="n">back_g</span> <span class="o">=</span> <span class="n">back</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">);</span>
<span class="n">back_b</span> <span class="o">=</span> <span class="n">back</span><span class="p">(:,:,</span><span class="mi">3</span><span class="p">);</span>

<span class="n">temp_r</span> <span class="o">=</span> <span class="n">combine_image</span><span class="p">(</span><span class="n">man_r</span><span class="p">,</span><span class="n">back_r</span><span class="p">);</span> <span class="c1">% process using function()</span>
<span class="n">temp_g</span> <span class="o">=</span> <span class="n">combine_image</span><span class="p">(</span><span class="n">man_g</span><span class="p">,</span><span class="n">back_g</span><span class="p">);</span>
<span class="n">temp_b</span> <span class="o">=</span> <span class="n">combine_image</span><span class="p">(</span><span class="n">man_b</span><span class="p">,</span><span class="n">back_b</span><span class="p">);</span>

<span class="n">final_image</span> <span class="o">=</span> <span class="nb">uint8</span><span class="p">(</span><span class="nb">zeros</span><span class="p">(</span><span class="nb">size</span><span class="p">(</span><span class="n">man</span><span class="p">)));</span>
<span class="n">final_image</span><span class="p">(:,:,</span><span class="mi">1</span><span class="p">)</span><span class="o">=</span> <span class="n">temp_r</span><span class="p">;</span> <span class="c1">% step 7 -combine output images to a single color image</span>
<span class="n">final_image</span><span class="p">(:,:,</span><span class="mi">2</span><span class="p">)</span><span class="o">=</span> <span class="n">temp_g</span><span class="p">;</span>
<span class="n">final_image</span><span class="p">(:,:,</span><span class="mi">3</span><span class="p">)</span><span class="o">=</span> <span class="n">temp_b</span><span class="p">;</span>

<span class="nb">figure</span><span class="p">;</span>
<span class="nb">imshow</span><span class="p">(</span><span class="n">final_image</span><span class="p">);</span>

</code></pre></div></div> <h5 id="the-function---combine_image">The Function - combine_image()</h5> <div class="language-matlab highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">combine_image</span><span class="p">(</span><span class="n">man</span><span class="p">,</span><span class="n">back</span><span class="p">)</span>
    <span class="n">man_b</span><span class="o">=</span> <span class="n">im2bw</span><span class="p">(</span><span class="n">man</span><span class="p">,</span><span class="mf">0.99</span><span class="p">);</span> <span class="c1">%  step 1</span>
    <span class="n">back_b</span> <span class="o">=</span> <span class="n">im2bw</span><span class="p">(</span><span class="n">back</span><span class="p">);</span>
    <span class="n">not_back</span> <span class="o">=</span> <span class="nb">not</span><span class="p">(</span><span class="n">back_b</span><span class="p">);</span> <span class="c1">% step 2</span>
    <span class="n">com</span> <span class="o">=</span> <span class="nb">and</span><span class="p">(</span><span class="n">man_b</span><span class="p">,</span><span class="n">not_back</span><span class="p">);</span> <span class="c1">% step 3 - Mask 1</span>
    <span class="n">com1</span> <span class="o">=</span> <span class="nb">not</span><span class="p">(</span><span class="n">com</span><span class="p">);</span> <span class="c1">% step 4 - Mask 2</span>
    <span class="n">with_man</span> <span class="o">=</span> <span class="n">com1</span><span class="o">.*</span><span class="nb">double</span><span class="p">(</span><span class="n">man</span><span class="p">);</span> <span class="c1">% step 5</span>
    <span class="n">with_tree</span> <span class="o">=</span> <span class="n">com</span><span class="o">.*</span><span class="nb">double</span><span class="p">(</span><span class="n">back</span><span class="p">);</span>
    <span class="n">sz</span><span class="o">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">com</span><span class="p">);</span>
    <span class="k">for</span> <span class="nb">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">sz</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1">% step 6</span>
        <span class="k">for</span> <span class="nb">j</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">sz</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">temp</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">)</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">with_man</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">),</span><span class="n">with_tree</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span><span class="nb">j</span><span class="p">));</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="nb">uint8</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>
<span class="k">end</span>
</code></pre></div></div> <p>I know this post was a bit long, but this is a cool example of some basic image processing techniques. If you want to learn more click <a href="http://onlinelibrary.wiley.com/book/10.1002/9780470689776" target="blank">here</a> for a reference to a great book.</p> <h6 id="so-until-next-time">So until next time.</h6> <h4 id="cheers-">Cheers !!</h4> <p><strong>Next: <a href="http://dinalherath.com/2017/hard-disks-1/">Simulation of Hard Disks : Part 1</a></strong> <br /> <strong>Prev: <a href="http://dinalherath.com/2017/serial-snake-robot/">Simulation of a serial snake robot</a></strong></p> <aside class="share"> <p>If you liked this article and think others should read it, please <a href="http://twitter.com/share?text=Combining video-game sprites using logical operations&amp;url=http://localhost:4000/2017/image-pokemon/&amp;via=" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">share it on Twitter <i class="fa fa-twitter" aria-hidden="true" style="color:#00aced"></i></a> or <a href='https://www.facebook.com/sharer/sharer.php?u='+url; onclick="window.open(this.href, 'sharer', 'toolbar=0,status=0,width=550,height=235');return false;">Facebook <i class="fa fa-facebook-square" aria-hidden="true" style="color:#3b5998"></i></a>.</p> </aside> </div> </article> <!-- --> <footer class="site-footer"> <!--<link rel="stylesheet" href="/assets/icons/academicons-1.8.0/css/academicons.css"/>--> <div class="container"> <small class="block"><!--&lt;/&gt; <a href="http://github.com/heiswayi/thinkspace" title="a minimalist Jekyll theme for technical writing">Thinkspace theme</a> by <a href="http://heiswayi.github.io">Heiswayi Nrird</a>. |--><i class="fa fa-copyright"></i> 2017-2019 Jerome Dinal Herath</small> <a href="mailto:dinal.bing@gmail.com"><i class="fa fa-envelope" style="font-size:21px;color:#F15B3D;"></i></a> <a href="https://www.facebook.com/dinalHerath" target="_blank"><i class="fa fa-facebook-square" style="font-size:22px;color:#F15B3D"></i></a> <a href="https://github.com/dherath" target="blank"><i class="fa fa-github-square" style="font-size:22px;color:#F15B3D"></i></a> <a href="https://www.linkedin.com/in/jerome-dinal-herath-bba3b0148/" target="blank"><i class="fa fa-linkedin-square" style="font-size:22px;color:#F15B3D"></i></a> <a href="/feed.xml" target="_blank"><i class="fa fa-rss-square" style="font-size:22px;color:#F15B3D"></i></a> <a href="https://www.researchgate.net/profile/Jerome_Dinal_Herath" target="blank"> <i style="font-size:20px;color:#F15B3D;font-weight:bold;"> RG </i></a> </div> </footer> </main> </body> </html>
